<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festicket Admin Dashboard - Cập Nhật</title>
    <link rel="stylesheet" href="/admin/admin-trangchu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <div class="container" id="mainDashboard">
        <div class="sidebar">
            <div class="logo">Festicket</div>
            <div class="menu-list">
                <div class="menu-item active" onclick="showSection('dashboard', 'Dashboard')">
                    <i class="fa-solid fa-gauge"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item"
                    onclick="showSection('users', 'Quản lí người mua vé'); initializeUserManagement();">
                    <i class="fa-solid fa-user"></i>
                    <span>Người mua vé</span>
                </div>
                <div class="menu-item"
                    onclick="showSection('events', 'Quản lí chương trình'); initializeEventManagement();">
                    <i class="fa-solid fa-calendar"></i>
                    <span>Chương trình</span>
                </div>

                <!-- <div class="menu-item" onclick="showSection('payments', 'Quản lí Thanh toán'); initializePaymentManagement();">
                    <i class="fa-solid fa-money-bill"></i>
                    <span>Thanh toán</span>
                </div> -->
                <div class="menu-item"
                    onclick="showSection('orders', 'Quản lí Đơn hàng'); initializeOrderManagement();">
                    <i class="fa-solid fa-folder"></i>
                    <span>Đơn hàng</span>
                </div>
                <div class="menu-item" onclick="showSection('tickets', 'Quản lí Vé đã mua'); initializeTicketList();">
                    <i class="fa-solid fa-ticket"></i>
                    <span>Vé đã mua</span>
                </div>
                <div class="menu-item" onclick="showSection('statistics', 'Thống kê & Báo cáo'); loadStatisticsData();">
                    <i class="fa-solid fa-chart-simple"></i>
                    <span>Thống kê</span>
                </div>
            </div>
            <div class="menu-item " onclick="handleLogout()">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span>Đăng xuất</span>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Dashboard</h1>
            </div>

            <div id="dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Tổng doanh thu</h3>
                        <div class="number"></div>
                    </div>
                    <div class="stat-card">
                        <h3>Vé đã bán</h3>
                        <div class="number"></div>
                    </div>
                    <div class="stat-card">
                        <h3>Số lượng đơn hàng</h3>
                        <div class="number"></div>
                    </div>
                    <div class="stat-card">
                        <h3>Người dùng mới</h3>
                        <div class="number"></div>
                    </div>
                </div>
                <div class="chart-container">
                    <h2 style="margin-bottom: 20px; color: #333;">Doanh thu 30 ngày gần nhất</h2>
                    <div style="height: 350px;"> <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="users" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Quản lí người dùng</h2>
                        <div>
                            <input type="text" class="search-box" id="userSearchInput"
                                placeholder="Tìm kiếm theo Họ tên...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Họ tên</th>
                                <th>Email</th>
                                <th>Số điện thoại</th>
                                <th>Ngày sinh</th>
                                <th>Giới tính</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

                <div id="editUserModal" class="modal-overlay">
                    <div class="modal-content">
                        <span class="close-btn" onclick="closeEditUserModal()">&times;</span>
                        <h2>Sửa thông tin người dùng</h2>
                        <form id="editUserForm">
                            <input type="hidden" id="editUserId">
                            <div class="form-group">
                                <label for="editHoTen">Họ và tên</label>
                                <input type="text" id="editHoTen" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="editEmail">Email</label>
                                <input type="email" id="editEmail" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label for="editSoDienThoai">Số điện thoại</label>
                                <input type="tel" id="editSoDienThoai" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="editNgaySinh">Ngày sinh</label>
                                <input type="date" id="editNgaySinh" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="editGioiTinh">Giới tính</label>
                                <select id="editGioiTinh" class="form-control">
                                    <option value="Nam">Nam</option>
                                    <option value="Nu">Nữ</option>
                                    <option value="Khac">Khác</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="events" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Quản lí chương trình</h2>
                        <div>
                            <input type="text" class="search-box" id="eventSearchInput"
                                placeholder="Tìm kiếm theo Tên chương trình...">
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã CT</th>
                                <th>Tên chương trình</th>
                                <th>Ngày giờ BĐ</th>
                                <th>Địa điểm</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

                <div id="editEventModal" class="modal-overlay">
                    <div class="modal-content" style="max-width: 600px;">
                        <span class="close-btn" onclick="closeEditEventModal()">&times;</span>
                        <h2>Sửa thông tin chương trình</h2>
                        <form id="editEventForm">
                            <input type="hidden" id="editEventId">
                            <div class="form-group">
                                <label for="editTenChuongTrinh">Tên chương trình</label>
                                <input type="text" id="editTenChuongTrinh" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="editMoTa">Mô tả</label>
                                <textarea id="editMoTa" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-group" style="display: flex; gap: 20px;">
                                <div style="flex: 1;">
                                    <label for="editNgayGioBatDau">Ngày giờ Bắt đầu</label>
                                    <input type="datetime-local" id="editNgayGioBatDau" class="form-control" required>
                                </div>
                                <div style="flex: 1;">
                                    <label for="editTrangThai">Trạng thái</label>
                                    <select id="editTrangThai" class="form-control">
                                        <option value="BanNhap">Bản Nháp</option>
                                        <option value="ChoDuyet">Chờ Duyệt</option>
                                        <option value="DangBan">Đang Bán</option>
                                        <option value="HetVe">Hết Vé</option>
                                        <option value="DaDienRa">Đã Diễn Ra</option>
                                        <option value="Huy">Hủy</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="editDiaDiem">Địa điểm</label>
                                <input type="text" id="editDiaDiem" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="editDanhSachNgheSi">Danh sách Nghệ sĩ</label>
                                <input type="text" id="editDanhSachNgheSi" class="form-control"
                                    placeholder="Ngăn cách bằng dấu phẩy (nếu có)">
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Lưu
                                thay đổi</button>
                        </form>
                    </div>
                </div>
            </div>




            <!-- <div id="payments" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Quản lí thanh toán</h2>
                        <input type="text" class="search-box" placeholder="Tìm kiếm giao dịch...">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã GD</th>
                                <th>Số tiền</th>
                                <th>Phương thức</th>
                                <th>Trạng thái</th>
                                <th>Ngày thanh toán</th>
                                <th>Đơn hàng (Mã Đơn)</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>#PAY001</td>
                                <td>2,500,000đ</td>
                                <td>Thẻ tín dụng</td>
                                <td><span class="badge badge-success">Thành công</span></td>
                                <td>18/11/2025 10:30</td>
                                <td>#ORD001</td>
                                <td><button class="action-btn btn-view">Xem</button></td>
                            </tr>
                            <tr>
                                <td>#PAY002</td>
                                <td>3,600,000đ</td>
                                <td>MoMo</td>
                                <td><span class="badge badge-success">Thành công</span></td>
                                <td>18/11/2025 14:00</td>
                                <td>#ORD002</td>
                                <td><button class="action-btn btn-view">Xem</button></td>
                            </tr>
                            <tr>
                                <td>#PAY003</td>
                                <td>1,200,000đ</td>
                                <td>Chuyển khoản</td>
                                <td><span class="badge badge-warning">Đang xử lí</span></td>
                                <td>19/11/2025 09:15</td>
                                <td>#ORD003</td>
                                <td><button class="action-btn btn-view">Xem</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div> -->
<!-- 
            <div id="payments" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Quản lí xác nhận thanh toán</h2>
                        <input type="text" class="search-box" id="paymentSearchInput"
                            placeholder="Tìm kiếm Mã GD/Mã Đơn hàng...">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã TT</th>
                                <th>Mã GD</th>
                                <th>Mã Đơn hàng</th>
                                <th>Số tiền</th>
                                <th>Phương thức</th>
                                <th>Ngày tạo</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody">
                            <tr>
                                <td colspan="8" style="text-align:center;">Vui lòng chờ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="editPaymentModal" class="modal-overlay">
                    <div class="modal-content" style="max-width: 450px;">
                        <span class="close-btn" onclick="closeEditPaymentModal()">&times;</span>
                        <h2>Cập nhật Thanh toán <span id="modalPaymentId"></span></h2>
                        <form id="editPaymentForm">
                            <input type="hidden" id="editPaymentId">
                            <div class="form-group">
                                <label>Mã Đơn hàng Code</label>
                                <input type="text" id="modalOrderCodeDisplay" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label>Số tiền / Phương thức</label>
                                <input type="text" id="modalPaymentSummary" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label for="editPaymentTrangThai">Trạng thái</label>
                                <select id="editPaymentTrangThai" name="status" class="form-control" required>
                                    <option value="ChoXuLy">Chờ Xử Lý</option>
                                    <option value="ThanhCong">Thành Công</option>
                                    <option value="ThatBai">Thất Bại</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Xác nhận</button>
                        </form>
                    </div>
                </div>
            </div> -->


            <div id="orders" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Quản lí đơn hàng</h2>
                        <input type="text" class="search-box" id="orderSearchInput"
                            placeholder="Tìm kiếm theo Mã đơn hàng Code...">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Mã đơn Code</th>
                                <th>Tổng tiền</th>
                                <th>Người mua vé</th>
                                <th>Ngày tạo</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                        </tbody>
                    </table>
                </div>






                <div id="editOrderModal" class="modal-overlay">
                    <div class="modal-content" style="max-width: 450px;">
                        <span class="close-btn" onclick="closeEditOrderModal()">&times;</span>
                        <h2>Cập nhật Đơn hàng <span id="modalOrderCode"></span></h2>
                        <form id="editOrderForm">
                            <input type="hidden" id="editOrderId" name="orderId">
                            <div class="form-group">
                                <label>Tổng tiền</label>
                                <input type="text" id="editOrderTongTien" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label>Người mua</label>
                                <input type="text" id="editOrderHoTen" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label for="editTrangThaiOrder">Trạng thái</label>
                                <select id="editTrangThaiOrder" name="status" class="form-control" required>
                                    <option value="ChoThanhToan">Chờ Thanh toán</option>
                                    <option value="DaThanhToan">Đã Thanh toán</option>
                                    <option value="Huy">Hủy</option>
                                    <option value="HoanTien">Hoàn tiền</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Lưu
                                thay đổi</button>
                        </form>
                    </div>
                </div>
            </div>
            <div id="tickets" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Danh sách Vé đã mua (Đơn hàng Đã Thanh toán)</h2>
                        <input type="text" class="search-box" id="ticketSearchInput"
                            placeholder="Tìm kiếm theo Tên khách hàng, Email, Mã ĐH...">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Mã ĐH</th>
                                <th>Tên Khách hàng</th>
                                <th>Email</th>
                                <th>Mã NMV</th>
                                <th>SL Vé</th>
                                <th>Tổng tiền</th>
                                <th>Ngày đặt</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="ticketListTableBody">
                            <tr>
                                <td colspan="9" style="text-align:center;">Vui lòng chờ...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- qr code -->


            <div id="qrModal" class="modal-overlay" style="display: none;">
                <div class="modal-content"
                    style="max-width: 650px; text-align: center; background:#2a2a2a; padding: 20px;">
                    <span class="close-btn"
                        style="color: white; top: 10px; right: 20px; font-size: 30px; cursor: pointer; position: absolute;"
                        onclick="document.getElementById('qrModal').style.display='none';">&times;</span>

                    <h2 style="color: #FF6A88; margin-bottom: 20px;">Chi Tiết Vé - Mã ĐH: <span
                            id="qrOrderCode">...</span></h2>
                    <p style="color:#aaa; margin-bottom: 20px;">Mỗi vé có mã QR độc nhất để check-in.</p>

                    <div id="individualTicketContainer"
                        style="max-height: 450px; overflow-y: auto; padding: 10px; background:#1a1a1a; border-radius:8px; display: flex; flex-direction: column; gap: 15px;">
                    </div>
                    <button class="btn btn-secondary" onclick="document.getElementById('qrModal').style.display='none';"
                        style="margin-top:20px; background: #6c757d;">Đóng</button>
                </div>
            </div>


            <!-- end-qrcode -->
            <div id="statistics" class="content-section">
                <div class="chart-container">
                    <h2 style="margin-bottom: 20px; color: #333;">Thống kê Số lượng đơn hàng theo ngày (30 ngày gần
                        nhất)</h2>
                    <div style="height: 350px;">
                        <canvas id="dailyOrdersChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h2 style="margin-bottom: 20px; color: #333;">Thống kê Tỷ lệ loại vé đã bán theo giá</h2>
                    <div style="height: 350px; max-width: 500px; margin: 0 auto;">
                        <canvas id="ticketRatioChart"></canvas>
                    </div>
                </div>
            </div>



        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> 
    <script src="/admin/admin-trangchu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="/header.js"></script>
    <script src="/admin/admin-dashboard.js"></script>
    <script src="/admin/admin-user.js"></script>
    <script src="/admin/admin-chuongtrinh.js"></script>
    <script src="/admin/admin-order.js"></script>
    <script src="/admin/admin-thongke.js"></script>
    <script src="/admin/admin-qrcode.js"></script>
    <script src="/admin/admin-payments.js"></script>
</body>

</html>